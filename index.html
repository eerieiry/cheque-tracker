<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Cheques</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; }
    table { border-collapse: collapse; width: 100%; max-width: 900px; margin: auto; }
    th, td { border: 1px solid #ccc; padding: 12px 16px; text-align: center; }
    th { background-color: #f4f4f4; }
    tfoot td {
      font-weight: bold;
      background-color: #fffacc; 
      font-size: 1.1em;
    }
    button {
      padding: 6px 12px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background-color: #45a049; }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      padding-top: 60px;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.8);
    }
    .modal-content {
      margin: auto;
      display: block;
      max-width: 90%;
      max-height: 80vh;
    }
    .close {
      position: absolute;
      top: 30px;
      right: 50px;
      color: #fff;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2 style="text-align:center;">Cheques</h2>

<table id="cheques-table">
  <thead>
    <tr><th>Date</th><th>Sum</th><th>Cheque</th></tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td>Summury:</td>
      <td id="total-sum">—</td>
      <td></td>
    </tr>
  </tfoot>
</table>

<div id="imageModal" class="modal">
  <span class="close" onclick="closeModal()">&times;</span>
  <img class="modal-content" id="modalImage">
</div>

<script>
function loadCSV() {
  fetch('data.csv')
    .then(response => response.text())
    .then(text => {
      const rows = text.trim().split('\n').slice(1); 
      let total = 0;

      const parsed = rows.map(row => {
        const [date, amount, image] = row.split(';');
        return {
          date: date.trim(),
          amount: amount.trim(),
          image: image.trim()
        };
      });

      parsed.sort((a, b) => new Date(b.date) - new Date(a.date));

      const table = document.querySelector("#cheques-table tbody");

      parsed.forEach(entry => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${entry.date}</td>
          <td>${entry.amount}</td>
          <td><button onclick="openModal('images/${entry.image}')">Open</button></td>
        `;
        table.appendChild(tr);

        const number = parseFloat(entry.amount.replace(',', '.').replace(/[^\d.]/g, ''));
        if (!isNaN(number)) total += number;
      });

      document.getElementById('total-sum').innerText = `${total.toFixed(2)} ₴`;
    });
}

function openModal(imageSrc) {
  document.getElementById('imageModal').style.display = 'block';
  document.getElementById('modalImage').src = imageSrc;
}
function closeModal() {
  document.getElementById('imageModal').style.display = 'none';
}

window.onload = loadCSV;
</script>

</body>
</html>
